#!/usr/bin/env ruby
require 'pathname' #detecting the correct path of a file even if its a symlink
require File.dirname(Pathname.new(__FILE__).realpath) + "/lib/fresnel"

COLOR=false
CACHE=true
CACHE_TIMEOUT=5.seconds
TERM_SIZE=80

fresnel=Fresnel.new(:cache=>CACHE, :cache_timeout=>CACHE_TIMEOUT)

case ARGV[0]
  when "projects"
    fresnel.projects
  when "tickets"
    fresnel.tickets
  when "create"
    fresnel.create
  when /\d+/
    if ARGV[1]
      case ARGV[1]
        when "comment"
          fresnel.comment(ARGV[0])
        when /^(open|closed?|hold|resolved|invalid)$/
          fresnel.change_state(:ticket=>ARGV[0],:state=>ARGV[1])
        else
          puts Frame.new(:header=>"Notice",:body=>"not sure what to do for #{ARGV[1]}")
      end
    else
      fresnel.show_ticket(ARGV[0])
    end
  else
    puts Frame.new(:header=>"Notice",:body=>"not sure what to do for #{ARGV[0]}")
end

